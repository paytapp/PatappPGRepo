package com.paymentgateway.phonepe;

import java.nio.Buffer;
import java.security.MessageDigest;
import java.util.Base64;

public class initiatePhonepe {

	public static void main(String[] args) {
		// TODO Auto-generated method stub

	}
	public boolean initiatePhonepePayment() {
		
		String purchaseId = "1006";
		String userId = "629388";
		int txnAmount = 116;
		txnAmount = txnAmount*100;
		String PHONEPE_MID = "POKERDADDYUAT"; 
		String PURCHASE_REDIRECT_URL="";
		String PHONEPE_CALLBACK_URL="";
		
		try {
			String  phonepe_payload_card_initiate = "{"+
				    "\"merchantId\":\""+PHONEPE_MID+"\","+
				    "\"merchantTransactionId\":\""+ purchaseId+"\","+
				    "\"merchantUserId\":\""+userId+"\","+
				    "\"amount\":\""+ txnAmount+"\","+
				    "\"redirectUrl\":\""+ PURCHASE_REDIRECT_URL + purchaseId+"\","+
				    "\"redirectMode\":\"POST\","+
				    "\"callbackUrl\":\""+ PHONEPE_CALLBACK_URL+"\","+
				    "\"paymentInstrument\"{"+
						"\"type\":\"PAY_PAGE\""+
				        	
				    "}";
			
			//phonepe_payload_card_initiate = JSON.stringify(phonepe_payload_card_initiate);

			
			System.out.println("PHONEPE-INITIATE-REQUEST"+ "raw_payload===--"+ phonepe_payload_card_initiate);
			        
			//String encoded = Buffer.from(phonepe_payload_card_initiate, "utf8").toString("base64");
			String encoded =Base64.getEncoder().encodeToString(phonepe_payload_card_initiate.getBytes());

			//console.log('');
			System.out.println("PHONEPE-INITIATE-REQUEST"+ "encoded====="+ encoded);
			


			String checksum = encoded + "/pg/v1/pay" + 1;

			
			System.out.println("PHONEPE-INITIATE-REQUEST"+ "checksum"+ checksum);

			//String hash = crypto.createHash("sha256").update(checksum, "utf-8").digest("hex");
			String hash =HashCrypto(checksum);
			
			System.out.println("PHONEPE-INITIATE-REQUEST"+ "hash"+ hash);

			
			
		}catch(Exception e) {
			e.printStackTrace();
		}
		return true;
	}
	
	public String HashCrypto(String input)throws Exception
    {
        String password = "seed";

        MessageDigest md = MessageDigest.getInstance("SHA-256");
        md.update(password.getBytes());

        byte byteData[] = md.digest();
        StringBuffer sb=null;

        //convert the byte to hex format method 1
        byte[] byteArray=input.getBytes();
        
        for (int i = 0; i < byteArray.length; i++) {
         sb.append(Integer.toString((byteData[i] & 0xff) + 0x100, 16).substring(1));
        }

        System.out.println("Hex format : " + sb.toString());

        //convert the byte to hex format method 2
        StringBuffer hexString = new StringBuffer();
        for (int i=0;i<byteData.length;i++) {
            String hex=Integer.toHexString(0xff & byteData[i]);
            if(hex.length()==1) hexString.append('0');
            hexString.append(hex);
        }
        return hexString.toString();
    }


}
