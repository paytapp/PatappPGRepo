package com.paymentgateway.phonePe;

import java.util.HashMap;

import org.springframework.beans.factory.annotation.Autowired;

import com.paymentgateway.phonePe.PhonePeCommon;

public class phonePeRequestGenerator {

	
	@Autowired
	PhonePeCommon common;
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		try {
			
		}catch(Exception e) {
			e.printStackTrace();
		}

	}

	public String requestCreator(String purchaseId,String userId,int amount,String phNo,String bankId,
			String encCardNumber,String encryptionKeyId,String cardHName,String month,String year,
			String encCvvNumber,String addressLine1,String addressLine2,String city,String state,
			String pinCode,String country) {
		
		String finalRequest="";
		String valDiff="";
		String valDiffStr="";

		HashMap prop = common.readProperty("phonePe.properties");
		
		//phonepeResponse phonepeResponseData=new phonepeResponse();
		//txnAmount = txnAmount*100;
		
		String baseUrl = prop.get("PHONEPE_BASE_URL").toString();
		String payEndpoint = prop.get("PHONEPE_PAY_ENDPOINT").toString();
		String PHONEPE_MID = prop.get("PHONEPE_MID").toString();
		String PURCHASE_REDIRECT_URL = prop.get("PURCHASE_REDIRECT_URL").toString();
		String PHONEPE_CALLBACK_URL = prop.get("PHONEPE_CALLBACK_URL").toString();
	//	saltKey = prop.get("PHONEPE_SALTKEY").toString();
	//	saltIndex = prop.get("PHONEPE_SALT_INDEX").toString();
	//	PHONEPE_REQUEST_URL = baseUrl + payEndpoint;
		String vpaStr="test-vpa@ybl";//Need to change
		
		try {
			
			finalRequest="{"+
					   "\"merchantId\": \""+PHONEPE_MID+"\","+
					   "\"merchantTransactionId\": \""+purchaseId+"\","+
					   "\"merchantUserId\": \""+userId+"\","+
					   "\"amount\":"+ amount+","+
					   "\"callbackUrl\": \""+PURCHASE_REDIRECT_URL+"\","+
					   "\"mobileNumber\": \""+phNo+"\",";
			// UPI Open Intent (ANDROID)
			if(valDiff.equalsIgnoreCase("UPIOpenIntent")){
			
				
				valDiffStr="\"deviceContext\": {"+
			     "\"deviceOS\": \"ANDROID\""+
			   "},"+
			   "\"paymentInstrument\": {"+
			   "\"type\": \"UPI_INTENT\","+
			     "\"targetApp\": \"com.phonepe.app\""+
			   "} }	}";
			 //-------------------------------
			// Sample Payload for Base64 - UPI Collect
			if(valDiff.equalsIgnoreCase("UPICollect")){
				
			 
				valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"UPI_COLLECT\","+
			     "\"vpa\": \""+vpaStr+"\""+
			   "}}}";
			 //------------------
			 //Sample Payload for Base64 - UPI QR
			 if(valDiff.equalsIgnoreCase("UPIQR")){
			 
				 valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"UPI_QR\""+
			  " } } }";
			 //--------------------------
			 //Sample Payload for Base64 - Web Flow
			 if(valDiff.equalsIgnoreCase("Web")){
			 
				 valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"PAY_PAGE\""+
			   "} } }";
			 //------------------------
			 //Sample Payload for Base64 - With Card Number
			 if(valDiff.equalsIgnoreCase("CardNumber")){
			 {
			 
				 valDiffStr="\"paymentInstrument\": {"+
			         "\"type\": \"CARD\","+
			         "\"authMode\": \"3DS\","+
			         "\"saveCard\": true,"+
			         "\"cardDetails\": {"+
			             "\"encryptedCardNumber\": \""+encCardNumber+"\","+
			             "\"encryptionKeyId\":"+ encryptionKeyId+","+
			             "\"cardHolderName\": \""+cardHName+"\","+
			             "\"expiry\": {"+
			                 "\"month\":\""+month+"\","+
			                 "\"year\":\""+year+"\""+
			             "},"+
			             "\"encryptedCvv\": \""+encCvvNumber+"\","+
			             "\"billingAddress\": {"+
			                 "\"line1\": \""+addressLine1+"\","+
			                 "\"line2\": \""+addressLine2+"\","+
			                 "\"city\": \""+city+"\","+
			                 "\"state\": \""+state+"\","+
			                 "\"zip\": \""+pinCode+"\","+
			                 "\"country\": \""+country+"\""+
			            " }} } }}";
			             
			 //--------------------
			 //Sample Payload for Base64 - With Card Id
			 if(valDiff.equalsIgnoreCase("CardId")){
			 
				 valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \""+SAVED_CARD+"\","+
			     "authMode": "3DS",
			     "cardDetails": {
			       "cardId": "C903889349294273423",
			       "encryptedCvv": "<encrypted_cvv_number>",
			       "encryptionKeyId": 10
			     }
			   }
			 }
			 }
			 //-------------
			 //Sample Payload for Base64 - With Token
			 if(valDiff.equalsIgnoreCase("Token")){
			 
			   "paymentInstrument": {
			     "type": "TOKEN",
			     "authMode": "3DS",
			     "tokenDetails": {
			       "encryptedCvv": "<encrypted_cvv_number>",
			       "cryptogram": "95031131582962057737",
			       "encryptedToken": "SJk7Sazu894+cHsxsTOLML5ZYseMzdQ",
			       "encryptionKeyId": 10,
			       "expiry": {
			         "month": "11",
			         "year": "2037"
			       },
			       "panSuffix": "1212",
			       "cardHolderName": "Prashant"
			     }
			   }
			 }
			 }
			 //------------------
			 //Sample Payload for Base64 - NET BANKING
			 if(valDiff.equalsIgnoreCase("NETBANKING")){
			 
				 valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"NET_BANKING\","+
			     "\"bankId\": \""+bankId+"\""+
			   "} } }";

		}catch(Exception e) {
			e.printStackTrace();
		}
		return finalRequest;
	}
	
	
	
}
