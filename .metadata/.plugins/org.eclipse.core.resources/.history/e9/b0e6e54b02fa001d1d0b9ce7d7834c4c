package com.paymentgateway.phonepe;

public class initiatePhonepe {

	public static void main(String[] args) {
		// TODO Auto-generated method stub

	}
	public boolean initiatePhonepePayment() {
		
		String purchaseId = "1006";
		String userId = "629388";
		int txnAmount = 116;
		txnAmount = txnAmount*100;
		String PHONEPE_MID = "POKERDADDYUAT"; 
		
		try {
			String  phonepe_payload_card_initiate = "{"+
				    "\"merchantId\":\""+ PHONEPE_MID+"\","+
				    "\"merchantTransactionId": purchaseId,"+
				    "\"merchantUserId": userId,"+
				    "\"amount": txnAmount,"+
				    "\"redirectUrl": PURCHASE_REDIRECT_URL + purchaseId,"+
				    "\"redirectMode": "POST","+
				    "\"callbackUrl": PHONEPE_CALLBACK_URL,"+
				    "\"paymentInstrument": {"+
						"\"type":"PAY_PAGE""+
				        	
				    "}";
			
			String phonepe_payload_card_initiate = JSON.stringify(phonepe_payload_card_initiate);

			console.log('');
			console.log('PHONEPE-INITIATE-REQUEST', 'raw_payload', phonepe_payload_card_initiate);
			        
			const encoded = Buffer.from(phonepe_payload_card_initiate, 'utf8').toString('base64')

			console.log('');
			console.log('PHONEPE-INITIATE-REQUEST', 'encoded', encoded);
			----------


			var checksum = encoded + "/pg/v1/pay" + PHONEPE_SALTKEY;

			console.log('');
			console.log('PHONEPE-INITIATE-REQUEST', 'checksum', checksum);

			let hash = crypto.createHash('sha256').update(checksum, 'utf-8').digest('hex');

			console.log('');
			console.log('PHONEPE-INITIATE-REQUEST', 'hash', hash);

			
			
		}catch(Exception e) {
			e.printStackTrace();
		}
		return true;
	}

}
