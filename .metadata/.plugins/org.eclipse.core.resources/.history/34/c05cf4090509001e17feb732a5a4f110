package com.paymentgateway.phonePe;

import java.util.HashMap;

import org.springframework.beans.factory.annotation.Autowired;

import com.paymentgateway.phonePe.PhonePeCommon;

public class phonePeRequestGenerator {

	
	@Autowired
	PhonePeCommon common;
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		String request ="";
		try {
			phonePeRequestGenerator ppRequestGenerator=new phonePeRequestGenerator();
			request=ppRequestGenerator.requestCreator("UPIOpenIntent","PurchesId","userId",100000,"9717323931","SBIN","encCardNumber",
					"encryptionKeyId","cardHName","month","year","encCvvNumber","addressLine1",
					"addressLine2","city","state","302021","country","cardId","cryptoGram",
					"panSuffix","encryptedToken1","encryptedToken2"); 
			
			System.out.println("Request is ---->"+request);
			
		}catch(Exception e) {
			e.printStackTrace();
		}

	}

	public String requestCreator(String valDiff,String purchaseId,String userId,int amount,String phNo,String bankId,
			String encCardNumber,String encryptionKeyId,String cardHName,String month,String year,
			String encCvvNumber,String addressLine1,String addressLine2,String city,String state,
			String pinCode,String country,String cardId,String cryptoGram,String panSuffix,
			String encryptedToken1,String encryptedToken2) {
		
		String finalRequest="";
		//String valDiff="";
		String valDiffStr="";

		HashMap prop = common.readProperty("phonePe.properties");
		
		//phonepeResponse phonepeResponseData=new phonepeResponse();
		//txnAmount = txnAmount*100;
		
		String baseUrl = prop.get("PHONEPE_BASE_URL").toString();
		String payEndpoint = prop.get("PHONEPE_PAY_ENDPOINT").toString();
		String PHONEPE_MID = prop.get("PHONEPE_MID").toString();
		String PURCHASE_REDIRECT_URL = prop.get("PURCHASE_REDIRECT_URL").toString();
		String PHONEPE_CALLBACK_URL = prop.get("PHONEPE_CALLBACK_URL").toString();
	//	saltKey = prop.get("PHONEPE_SALTKEY").toString();
	//	saltIndex = prop.get("PHONEPE_SALT_INDEX").toString();
	//	PHONEPE_REQUEST_URL = baseUrl + payEndpoint;
		String vpaStr="test-vpa@ybl";//Need to change
		
		try {
			
			finalRequest="{"+
					   "\"merchantId\": \""+PHONEPE_MID+"\","+
					   "\"merchantTransactionId\": \""+purchaseId+"\","+
					   "\"merchantUserId\": \""+userId+"\","+
					   "\"amount\":"+ amount+","+
					   "\"callbackUrl\": \""+PURCHASE_REDIRECT_URL+"\","+
					   "\"mobileNumber\": \""+phNo+"\",";
			// UPI Open Intent (ANDROID)
			if(valDiff.equalsIgnoreCase("UPIOpenIntent")){
			
				
				valDiffStr="\"deviceContext\": {"+
			     "\"deviceOS\": \"ANDROID\""+
			   "},"+
			   "\"paymentInstrument\": {"+
			   "\"type\": \"UPI_INTENT\","+
			     "\"targetApp\": \"com.phonepe.app\""+
			   "} }	";
			}
			 //-------------------------------
			// Sample Payload for Base64 - UPI Collect
			if(valDiff.equalsIgnoreCase("UPICollect")){
				
			 
				valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"UPI_COLLECT\","+
			     "\"vpa\": \""+vpaStr+"\""+
			   "}}";
			}
			 //------------------
			 //Sample Payload for Base64 - UPI QR
			 if(valDiff.equalsIgnoreCase("UPIQR")){
			 
				 valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"UPI_QR\""+
			  " } } ";
			 }
			 //--------------------------
			 //Sample Payload for Base64 - Web Flow
			 if(valDiff.equalsIgnoreCase("Web")){
			 
				 valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"PAY_PAGE\""+
			   "} } ";
			 }
			 //------------------------
			 //Sample Payload for Base64 - With Card Number
			 if(valDiff.equalsIgnoreCase("CardNumber")){
			 			 
				 valDiffStr="\"paymentInstrument\": {"+
			         "\"type\": \"CARD\","+
			         "\"authMode\": \"3DS\","+
			         "\"saveCard\": true,"+
			         "\"cardDetails\": {"+
			             "\"encryptedCardNumber\": \""+encCardNumber+"\","+
			             "\"encryptionKeyId\":"+ encryptionKeyId+","+
			             "\"cardHolderName\": \""+cardHName+"\","+
			             "\"expiry\": {"+
			                 "\"month\":\""+month+"\","+
			                 "\"year\":\""+year+"\""+
			             "},"+
			             "\"encryptedCvv\": \""+encCvvNumber+"\","+
			             "\"billingAddress\": {"+
			                 "\"line1\": \""+addressLine1+"\","+
			                 "\"line2\": \""+addressLine2+"\","+
			                 "\"city\": \""+city+"\","+
			                 "\"state\": \""+state+"\","+
			                 "\"zip\": \""+pinCode+"\","+
			                 "\"country\": \""+country+"\""+
			            " }} } }";
			 }
			 //--------------------
			 //Sample Payload for Base64 - With Card Id
			 if(valDiff.equalsIgnoreCase("CardId")){
			 
				 valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"\"SAVED_CARD\","+
			     "\"authMode\": \"3DS\","+
			     "\"cardDetails\": {"+
			       "\"cardId\": \""+cardId+"\","+
			       "\"encryptedCvv\": \""+encCvvNumber+"\","+
			       "\"encryptionKeyId\":"+ encryptionKeyId+
			     "} } } ";
			 }
			 //-------------
			 //Sample Payload for Base64 - With Token
			 if(valDiff.equalsIgnoreCase("Token")){
			 
				 valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"TOKEN\","+
			     "\"authMode\": \"3DS\","+
			     "\"tokenDetails\": {"+
			      "\"encryptedCvv\": \""+encCvvNumber+"\","+
			       "\"cryptogram\": \""+cryptoGram+"\","+
			       //"\"encryptedToken\":\""+SJk7Sazu894+cHsxsTOLML5ZYseMzdQ+"\","+
			       "\"encryptedToken\":\""+encryptedToken1+encryptedToken2+"\","+
			       "\"encryptionKeyId\":"+ encryptionKeyId+","+
			       "\"expiry\": {"+
			         "\"month\": \""+month+"\","+
			         "\"year\": \""+year+"\""+
			       "},"+
			       "\"panSuffix\": \""+panSuffix+"\","+
			       "\"cardHolderName\": \""+cardHName+"\""+
			    " } } } ";
			 }
			 
			 //------------------
			 //Sample Payload for Base64 - NET BANKING
			 if(valDiff.equalsIgnoreCase("NETBANKING")){
			 
				 valDiffStr="\"paymentInstrument\": {"+
			     "\"type\": \"NET_BANKING\","+
			     "\"bankId\": \""+bankId+"\""+
			   "} } ";
			 }
			 finalRequest=finalRequest+valDiffStr;
		}catch(Exception e) {
			e.printStackTrace();
		}
		return finalRequest;
	}
	
	
	
}
